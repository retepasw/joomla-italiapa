(typeof(tinymce)!=="undefined")&&tinymce.PluginManager.add("ipa",function(h,i){console.log("TinyMCE for ItaliaPA v.__DEPLOY_VERSION__");var w=Joomla.getOptions?Joomla.getOptions("plg_system_ipatinymce",{}):(Joomla.optionsStorage.plg_system_ipatinymce||{}),A=w.jsurl||i,m=w.cssurl||i;tinymce.DOM.loadCSS(m+"/editor.min.css");h.contentCSS.push(m+"/italiapa.min.css");h.contentCSS.push(m+"/content.min.css");var j=new tinymce.dom.ScriptLoader();j.add(A+"/uuid.min.js");j.loadQueue();var H=[];var s=function(){var K=h.selection.getNode();var I=(K.nodeName.toLowerCase()=="a")&&h.dom.hasClass(K,"Tooltip-toggle");var N="",L="",J="";if(I){N=h.dom.getAttrib(K,"href").substr(1);L=K.innerHTML;var M=h.getDoc().getElementById(N).firstChild;while(M){if(M.nodeName.toLowerCase()=="span"){J=M.innerHTML}M=M.nextSibling}}else{N="tooltip-"+uuid.v4();L=h.selection.getContent()}h.windowManager.open({title:"Tooltip",body:[{type:"textbox",name:"id",minWidth:400,label:"ID",value:N,disabled:true},{type:"textbox",name:"text",minWidth:400,label:"Text",value:L},{type:"textbox",name:"tooltip",minWidth:400,label:"Tooltip",value:J,minHeight:80,multiline:true}],onsubmit:function(R){var T=R.data.id;var S=R.data.text;var Q=R.data.tooltip;var P='<span class="Icon-drop-down Dropdown-arrow u-color-teal-70"></span><span class="u-layout-prose u-text-r-xs">'+Q+"</span>";if(I){K.innerHTML=S;h.getDoc().getElementById(T).innerHTML=P}else{var O='<a href="#'+T+'" class="Tooltip-toggle u-textClean u-padding-right-xs u-padding-left-xs u-background-teal-50 u-color-black" data-menu-trigger="'+T+'">'+S+'</a><span id="'+T+'" data-menu aria-hidden="true" class="Dropdown-menu u-borderShadow-m u-background-teal-70 u-color-white u-layout-prose u-padding-r-all u-borderRadius-l">'+P+"</span>";h.selection.setContent(O)}}})};H.push({icon:"none icon-ipa-tooltip",text:"Tooltip",context:"insert",onclick:s});h.addButton("ipa-tooltip",{text:null,icon:"none icon-ipa-tooltip",tooltip:"Tooltip",onclick:s,stateSelector:"a.Tooltip-toggle[data-menu-trigger]"});var k=function(){var M=h.selection.getNode();var K=(M.nodeName.toLowerCase()=="button")&&h.dom.hasClass(M,"js-fr-dialogmodal-open");var I="",Q="",P="",N="",R="";if(K){I=h.dom.getAttrib(M,"aria-controls");Q=M.innerHTML;var J=h.getDoc().getElementById(I).firstChild.firstChild;var L=J.firstChild;if(L.nodeName.toLowerCase()==="h2"){P=L.innerHTML;L.parentNode.removeChild(L)}var O=J.lastChild;if(O.nodeName.toLowerCase()==="button"){R=O.innerHTML;O.parentNode.removeChild(O)}N=J.innerHTML}else{I="dialog-"+uuid.v4();Q=h.selection.getContent()}h.windowManager.open({title:"Dialog",body:[{type:"textbox",name:"id",minWidth:400,label:"ID",value:I,disabled:true},{type:"textbox",name:"text",minWidth:400,label:"Apri",value:Q},{type:"textbox",name:"title",minWidth:400,label:"Titolo",value:P},{type:"textbox",name:"dialog",minWidth:400,label:"Testo",value:N,minHeight:80,multiline:true},{type:"textbox",name:"close",minWidth:400,label:"Chiudi",value:R}],onsubmit:function(U){var Z=U.data.id,X=U.data.text,W=U.data.title,S=U.data.dialog,V=U.data.close,Y='<div class="Dialog-content Dialog-content--centered u-background-white u-layout-prose u-margin-all-xl u-padding-all-xl js-fr-dialogmodal-modal" aria-labelledby="modal-title-'+Z+'"><div role="document" class="Prose"><h2 class="u-cf u-text-h2 u-borderHideFocus" id="modal-title-'+Z+'" tabindex="0">'+W+"</h2>"+S+(V?'<button class="Button Button--danger js-fr-dialogmodal-close u-floatRight">'+V+"</button>":"")+"</div></div>";if(K){M.setAttribute("aria-controls",Z);M.innerHTML=X;h.getDoc().getElementById(Z).innerHTML=Y}else{var T='<button class="Button Button--default js-fr-dialogmodal-open" aria-controls="'+Z+'">'+X+'</button><div class="Dialog js-fr-dialogmodal" id="'+Z+'">'+Y+"</div>";h.selection.setContent(T)}}})};H.push({icon:"none icon-out-2",text:"Dialog",context:"insert",onclick:k});h.addButton("ipa-dialog",{text:null,icon:"none icon-out-2",tooltip:"Dialog",onclick:k,stateSelector:"button.js-fr-dialogmodal-open"});function B(K){var J=h.dom.getParent(h.selection.getNode(),"div.Alert")||h.selection.getNode(),I=h.dom.hasClass(J,"Alert"),N={error:"Si &egrave; verificato un errore",warning:"Attenzione",success:"Operazione effettuata con successo",info:"Ulteriori informazioni"},M=h.selection.getContent()||K.charAt(0).toUpperCase()+K.slice(1),L=N[K];node=h.dom.create("div",{role:"alert","class":"Prose Alert Alert--"+K+" Alert--withIcon u-layout-prose u-padding-r-bottom u-padding-r-right u-margin-r-bottom"});if(I){node.innerHTML=J.innerHTML;J.parentNode.replaceChild(node,J)}else{node.innerHTML='<h2 class="u-text-h3">'+L+'</h2><p class="u-text-p">'+M+"</p>";h.selection.setContent(node.outerHTML)}}var t=[],u,f;tinymce.each(["error","warning","success","info"],function(I){if(!f){f=I}t.push({icon:"none icon-"+I,text:I.charAt(0).toUpperCase()+I.slice(1),context:"insert",onclick:function(){u=I;B(I)}})});h.addButton("ipa-alert",{icon:"none icon-alert",type:"splitbutton",title:"Alert",onclick:function(){B(u||f)},menu:t,stateSelector:"div.Alert"});H.push({icon:"none icon-alert",text:"Alert",menu:t});function c(K){var I=h.dom.getParent(h.selection.getNode(),"div.Callout")||h.selection.getNode(),J=h.dom.hasClass(I,"Callout"),N={must:"Must",should:"Should",could:"Could",example:"Example"},M=h.selection.getContent()||K.charAt(0).toUpperCase()+K.slice(1),L=N[K];node=h.dom.create("div",{role:"note","class":"Callout Callout--"+K+" u-text-r-xs"});if(J){node.innerHTML=I.innerHTML;I.parentNode.replaceChild(node,I)}else{node.innerHTML='<h2 class="Callout-title u-text-r-l">'+L+'</h2><p class="u-layout-prose u-color-grey-90 u-text-p u-padding-r-all">'+M+"</p>";h.selection.setContent(node.outerHTML)}}var D=[],e,d;tinymce.each(["must","should","could","example"],function(I){if(!d){d=I}D.push({icon:"none icon-"+I,text:I.charAt(0).toUpperCase()+I.slice(1),context:"insert",onclick:function(){e=I;c(I)}})});h.addButton("ipa-callout",{icon:"none icon-callout",type:"splitbutton",title:"Callout",onclick:function(){c(e||d)},menu:D,stateSelector:"div.Callout"});H.push({icon:"none icon-callout",text:"Callout",menu:D});var q;var y=function(J,K){var I=J.settings.plugins?J.settings.plugins:"";return tinymce.util.Tools.inArray(I.split(/[ ,]/),K)!==-1};function l(I){return h.$.contains(h.getBody(),I)}function a(I){return I&&(/^(OL|UL|DL)$/).test(I.nodeName)&&l(I)}function G(J,I){function K(){var N,L,M;L=h.dom.select("dt[data-mce-selected]");N=L[0];if(!N){N=h.selection.getStart()}M=!h.dom.getParent(N,I);J.disabled(M);h.selection.selectorChanged(I,function(O){J.disabled(!O)})}if(h.initialized){K()}else{h.on("init",K)}}function b(J,I){function K(){var M,L,N;M=h.selection.getStart();parent=h.dom.getParent(M,I);L=!parent;J.disabled(L);N=C(parent);J.active(!L&&N);h.selection.selectorChanged(I,function(O){M=h.selection.getStart();parent=h.dom.getParent(M,I);O=!parent;J.disabled(O);N=C(parent);J.active(!O&&N)})}if(h.initialized){K()}else{h.on("init",K)}}function F(){G(this,"dl.Accordion>dt:not([aria-selected=true])")}function p(){G(this,"dl.Accordion>dt[aria-selected=true]")}function r(){b(this,"dl.Accordion")}function o(I){return I&&I.nodeName==="DL"&&h.dom.hasClass(I,"Accordion")}function n(I){return tinymce.util.Tools.grep(I,o).length>0}function C(J){var I;if(J&&J.nodeName==="DL"&&h.dom.hasClass(J,"Accordion")){if(!J.hasAttribute("aria-multiselectable")){I=true}else{I=J.getAttribute("aria-multiselectable")!=="false"}}else{I=false}return I}function z(K,I){var J=[];if(I){tinymce.util.Tools.each(I.split(/[ ,]/),function(L){J.push({text:L.replace(/\-/g," ").replace(/\b\w/g,function(M){return M.toUpperCase()}),data:L=="default"?"":L})});J.push({text:"-"});J.push({text:"Multi",onclick:function(){var L=this;h.undoManager.transact(function(){var N,O=h.dom,M=h.selection;N=O.getParent(M.getNode(),"dl");if(N&&N.nodeName=="DL"){if(!N.hasAttribute("aria-multiselectable")){N.setAttribute("aria-multiselectable","false");L.active(false)}else{if(N.getAttribute("aria-multiselectable")==="false"){N.removeAttribute("aria-multiselectable");L.active(true)}else{N.setAttribute("aria-multiselectable","false");L.active(false)}}}})},selectable:true,onpostrender:r});J.push({text:"-"});J.push({icon:"none icon-arrow-up",text:"Open",onclick:function(){h.undoManager.transact(function(){var L,N=h.dom,M=h.selection;L=N.getParent(M.getNode(),"dt");if(L&&L.nodeName=="DT"){N.setAttrib(L,"aria-selected","true");N.setAttrib(L,"aria-expanded","true")}})},onpostrender:F});J.push({icon:"none icon-arrow-down",text:"Close",onclick:function(){h.undoManager.transact(function(){var L,N=h.dom,M=h.selection;L=N.getParent(M.getNode(),"dt");if(L&&L.nodeName=="DT"){N.setAttrib(L,"aria-selected","");N.setAttrib(L,"aria-expanded","")}})},onpostrender:p})}return J}var E="default,Accordion,Accordion--default,Accordion--plus,Timeline";q=z("DL",h.getParam("deflist_styles",E));function x(J,I){if(I==null){return}h.undoManager.transact(function(){var L,M=h.dom,K=h.selection;L=M.getParent(K.getNode(),"dl");if(!L||L.nodeName!=J||I===false){h.execCommand("InsertDefinitionList",false,null)}L=M.getParent(K.getNode(),"dl");if(L){tinymce.util.Tools.each(M.select("dl",L).concat([L]),function(N){if(N.nodeName!==J&&I!==false){N=M.rename(N,J)}tinymce.util.Tools.each(h.getParam("deflist_styles",E).split(/[ ,]/),function(O){M.removeClass(N,O)});if((I=="Accordion--default")||(I=="Accordion--plus")){M.addClass(N,"Accordion")}if(I!==""){M.addClass(N,I)}})}h.focus()})}function v(L){var M=h.dom,I=[],K=M.getParent(h.selection.getNode(),"dl");tinymce.util.Tools.each(E.split(/[ ,]/),function(N){I.push(N.replace(/\-/g," ").replace(/\b\w/g,function(O){return O.toUpperCase()}))});if(K){var J=null;L.control.items().each(function(N){if(tinymce.util.Tools.inArray(I,N.settings.text)!==-1){N.active(false);if(M.hasClass(K,N.settings.data)){J=N}}if(N.settings.data==""){J=J||N}});J.active(true)}}var g=function(I){return function(){var J=this;h.on("NodeChange",function(L){var K=tinymce.util.Tools.grep(L.parents,a);J.active(K.length>0&&K[0].nodeName===I)})}};if(y(h,"lists")){h.addCommand("ApplyDefinitionListStyle",function(J,I){x("DL",false)});h.addButton("ipa-deflist",{type:(q.length>0)?"splitbutton":"button",tooltip:"Definition list",icon:"none icon-list-2",menu:q,onPostRender:g("DL"),onshow:v,onselect:function(I){x("DL",I.control.settings.data)},onclick:function(){x("DL",false)}});h.on("keyup",function(K){if((K.keyCode==13)&&!K.shiftKey){var I,L=h.dom,J=h.selection;I=L.getParent(J.getNode(),"dt,dd");if(I){if(I.nodeName=="DT"){L.rename(I,"dd")}else{if(I.nodeName=="DD"){L.rename(I,"dt")}}}}})}H.push({icon:"none icon-list-2",text:"DL",title:"Definition list",onselect:function(I){x("DL",I.control.settings.data)},onclick:function(){x("DL",false)},onPostRender:g("DL"),onshow:v,menu:q});h.addMenuItem("ipa",{icon:"none icon-ipa",text:"ItaliaPA",menu:H,context:"insert"});h.addButton("blockquote",{text:null,icon:"blockquote",tooltip:"Blockquote",onclick:function(){tinyMCE.activeEditor.selection.setContent('<blockquote class="Prose-blockquote"><p class="u-layout-prose u-color-grey-90 u-text-p u-padding-r-all">'+((text=tinyMCE.activeEditor.selection.getContent())?text:"Citazione")+"</p></blockquote>")}});h.addButton("codesample",{text:null,icon:"code",tooltip:"Code",onclick:function(){tinyMCE.activeEditor.selection.setContent('<pre class="u-textPreformatted u-textOverflow language-markup"><code class="u-text-r-xxs">'+((text=tinyMCE.activeEditor.selection.getContent())?text:"Codice")+"</code></pre>")}});h.on("init",function(){var I="p,h1,h2,h3,h4,h5,h6,td,th,div,ul,ol,li,table";h.settings.inline_styles=false;h.settings.table_default_attributes={"class":"Table Table--withBorder u-text-r-xs"};h.formatter.register({aligncenter:[{selector:I,classes:"u-textCenter"},{selector:"img",styles:{"max-width":"100%",height:"auto",display:"block","margin-left":"auto","margin-right":"auto"}}],alignleft:[{selector:I,classes:"u-textLeft"},{selector:"img",styles:{"max-width":"100%",height:"auto",display:"block","margin-left":"0","margin-right":"auto"}}],alignright:[{selector:I,classes:"u-textRight"},{selector:"img",styles:{"max-width":"100%",height:"auto",display:"block","margin-left":"auto","margin-right":"0"}}],h1:{block:"h1",classes:"u-text-h1",exact:true},h2:{block:"h2",classes:"u-text-h2",exact:true},h3:{block:"h3",classes:"u-text-h3",exact:true},h4:{block:"h4",classes:"u-text-h4",exact:true},h5:{block:"h5",classes:"u-text-h5",exact:true},h6:{block:"h6",classes:"u-text-h6",exact:true}})})});